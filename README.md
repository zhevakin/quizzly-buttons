# Общие сведения

Игровая система состоит из приемника сигнала и кнопок. Приемник присоединяется к компьютеру по USB и нужен для коммуникации с кнопками.

Кнопки и примемник работают на базе контроллеров ESP32.

Для загрузки прошивки на контроллер используется Arduino IDE https://www.arduino.cc/en/software

После установки, нужно добавить в IDE поддержку ESP32 и библиотеку FastLED

## Принцип работы игровой системы

Приемник подключен по USB к компьютеру, на котором открыт сайт квизли и подключен при помощи Web Serial API. У приемника есть заданный ID (SET_ID).

У каждой кнопки задан ID приемника (SET_RECEIVER_ID) и когда они включены происходит пейринг кнопок и приемника.

На примемник приходит сигнал о нажатии кнопок, который он транслирует по USB на сайт.

Сайт может посылать сообщения на приемник, которые он передает кнопкам.

## Настройка игровой системы

1. Задать ID применика (отравить команду SET_ID:$RECEIVER_ID на приемник через USB).
2. Задать различные BUTTON_ID кнопкам (команда SET_BUTTON_ID:$BUTTON_ID).
3. Задать кнопкам ID приемника (отправить команду SET_RECEIVER_ID:$RECEIVER_ID).

Примечание: такая настройка обеспечивает возможность менять приемник, таким образом комбинируя кнопки в разных наборах.

## Отправка команд на кнопки

Есть 4 варианта отправки команд на кнопки:

- через приемник командой BROADCAST:$BUTTON_COMMAND. Команда отправится ВСЕМ кнопкам в раудисе действия приемника, даже тем, которые не спарены с приемником.
- через приемник командой PAIRED_BUTTONS:$BUTTON_COMMAND. Команда отправится ВСЕМ кнопкам, спареным с приемником.
- через приемник командой BUTTON:$BUTTON_ID:$BUTTON_COMMAND. Команда отправится кнопке с заданым $BUTTON_ID
- через USB

## Исходяшие команды кнопок

- BUTTON_PRESS:$BUTTON_ID

## Входяшие команды кнопок

- ENABLE - кнопка активна и отсылает BUTTON_PRESS при нажатии

- DISABLE - кнопка неактивна и не отсылает BUTTON_PRESS при нажатии

- BLOCK - кнопка заблокирована и не реагирует на команды ENABLE/DISABLE (нужно для блокировки неправильно ответивших игроков)

- UNBLOCK - кнопка разблокирована и реагирует на команды ENABLE/DISABLE

- LED_ON - лампочка горит

- LED_OFF - лампочка не горит

- SET_BUTTON_ID - задать ID кнопки

- GET_BUTTON_ID - напечатать ID кнопки

- SET_RECEIVER_ID - задать ID приемника

- GET_RECEIVER_ID - получить ID приемника

- SET_LED_COLOR:$RED:$GREEN:$BLUE - задать цвет лампочки

- FLASH - поморгать текущим цветом

- RANDOM_COLOR_FLASH - поморгать рандомными цветами

## Входяшие команды приемника

- SET_ID - задать ID приемника

- GET_ID - напечатать ID приемника

- BROADCAST:$BUTTON_COMMAND

- PAIRED_BUTTONS:$BUTTON_COMMAND

- BUTTON:$BUTTON_ID:$BUTTON_COMMAND
